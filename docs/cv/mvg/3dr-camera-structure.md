---
counter: true
comment: true
---

# 摄像机和结构的 3D 重构

!!! abstract
    重构的任务是求摄像机矩阵$P$和$P^\prime$，以及 3D 中的点$\mathbf{X}_i$，使得对所有 i，有

    $$
    \mathbf{x}_i=P \mathbf{X}_i \ \ \ \ \ \ \mathbf{x}_i^\prime=P^\prime \mathbf{X}_i
    $$

## 重构方法概述

- 由两视图重构的一种方法：
    1. 由对应点计算基本矩阵
    2. 由基本矩阵计算摄像机矩阵
    3. 针对每组对应点$\mathbf{x}_i \leftrightarrow \mathbf{x}_i^\prime$，计算空间中映射到这两个图像点到点


## 重构的多义性

- 若没有景物在某个 3D 坐标系下位置的信息，一般不可能从一对视图（或事实上从任意数目的视图）重构该景物的绝对位置和朝向。仅由图像来确定景物就要相差一个相似变换（旋转、平移和缩放）
- **射影多义性**：如果既不知道任何一个摄像机的标定，也不知道一个摄像机与另一个的相对位置，那么重构的多义性由一个任意射影变换表示
    - 如果两个摄像机之间有平移运动，但标定不变，则可在相差一个仿射变换下重构
    - 如果两个摄像机除了焦距外都以标定，则仍然可在相差一个相似变换下重构


## 射影重构定理

- 如果两幅视图的一个点对应集唯一地确定了基本矩阵，则景物和摄像机可以仅由这些对应重构，而且由这些对应产生的任何两个重构都是射影等价的
- **射影重构定定理*：假定$\mathbf{x}_i \leftrightarrow \mathbf{x}_i^\prime$是两幅图像点之间对应的集合而且基本矩阵 F 由条件$\mathbf{x}_i^{\prime \top} F \mathbf{x}_i=0$（对所有 i 成立）唯一地确定。令$(P_1,P_1^\prime,\{\mathbf{X}_{1i}\})$和$(P_2,P_2^\prime,\{\mathbf{X}_{2i}\})$为对应$\mathbf{x}_i \leftrightarrow \mathbf{x}_i^\prime$的两个重构，则存在一个非奇异矩阵 H 使得$P_2=P_1H^{-1},P_2^\prime=P_1^\prime H^{-1}$并且除了使得$F\mathbf{x}_i=F^\top \mathbf{x}_i^\prime=\mathbf{0}$的那些 i 外，对其余每个 i 都有$\mathbf{X}_{2i}=H\mathbf{X}_{1i}$


## 分层重构

### 仿射重构

- 仿射重构的本质是用某些方法定位无穷远平面，因为定位无穷远平面等价于仿射重构。寻找使$\pi$映射到$(0,0,0,1)^\top$，可以把$H^{-\top}$作为 Houscholder 矩阵来计算
- **平移运动**
    - 摄像机作纯平移运动时，可以由两幅视图实现仿射重构。无穷远平面上一点$\mathbf{X}$在由摄像机平移所产生的两幅图像上的像是同一点。给定一个射影重构，可以重构对应于匹配$\mathbf{x}_i \leftrightarrow \mathbf{x}_i^\prime$的点$\mathbf{X}_i$。点$\mathbf{X}_i$将在无穷远平面上。从三组这样的点我们可以得到在无穷远平面上的三个点——足够唯一地把它确定
    - 假设摄像机的运动是没有旋转且内参保持不变的一个纯平移运动，则$F=[\mathbf{e}]_\times = [\mathbf{e}^\prime]_\times$，并且作为仿射重构可选的两个摄像机为$P=[I|\mathbf{0}]$和$P^\prime=[I|\mathbf{e}^\prime]$
- **景物约束**：景物约束或条件也可以用来获得仿射重构，只要能够辨认在无穷远平面上的三个点，该平面就可以辨认，并且该重构可以变换到仿射重构
- **平行直线**：最明显的条件是知道某些 3D 直线实际是平行的。空间两条平行直线的交点给出无穷远平面上的一个点，该交点的图像是这对平行线的消影点，而且是两条像直线的交点。假设在景物中能够确定三对平行直线。每对相交于无穷远平而上的一点，如果每对有不同的方向，则三点将不同。因为三点确定一张平面，故这个信息足够确定平面$\pi$
- **直线上的距离比率**：运动景物仿射长度比率不变的知识计算消影点
- **无穷单应**：如果一个仿射重构已得到并且其中的摄像机矩阵是$P=[I|\mathbf{0}]$和$P^\prime=[M^\prime|\mathbf{e}^\prime]$，则无穷单应是$H_\infty=M^\prime$。反过来，如果已得到无穷单应$H_\infty$，则仿射重构的摄像机可以取为$P=[I|\mathbf{0}]$和$P^\prime=[H_\infty|\mathbf{e}^\prime]$
- **其中一个是仿射摄像机的情形**：若$(P,P^\prime,\{\mathbf{X}_i\})$是从一点对应集得到的射影重构且$P=[I|\mathbf{0}]$。若已知$P$事实上是一个仿射摄像机，则可以通过交换$P$和$P^\prime$的最后两个列和每一个$\mathbf{X}_i$的最后两个坐标而得到一个仿射重构

### 度量重构

- 仿射重构的关键是辨认无穷远平面，而度最重构的关键是辨认绝对二次曲线
- 若已知绝对二次曲线在某幅图像中的像是$\omega$，且已知仿射重构中的摄像机矩阵是$P=[M|\mathbf{m}]$，则用形如$H=\begin{bmatrix} A^{-1} & \\ & 1 \end{bmatrix}$ 的 3D 变换，可以把仿射重构变换到度量重构，其中$A$由方程$AA^\top=(M^\top \omega M)^{-1}$的 Cholesky 分解得到

??? note "Cholesky 分解"
    Cholesky 分解是把一个对称正定的矩阵表示成一个下三角矩阵$L$和其转置的乘积的分解。它要求矩阵的所有特征值必须大于零，故分解的下三角的对角元也是大于零的。Cholesky 分解法又称平方根法，是当$A$为实对称正定矩阵时，$LU$三角分解法的变形。

- **景物正交的约束**：景物的正交直线的一对消影点$\mathbf{v}_1,\mathbf{v}_2$对$\omega$提供一个线性约束:$\mathbf{v}_1^\top \omega \mathbf{v}_2 = 0$。类似地，来自一个方向的消影点$\mathbf{v}$和与之垂直的平面的消影直线$\mathbf{l}$对$\omega$提供两个约束$\mathbf{l}=\omega \mathbf{v}$，一个常用的例子是垂直方向的消影点和水平地平面的消影直线
- **已知内参数的约束**：如果摄像机矩阵的标定矩阵等于$K$，则绝对二次曲线的像是$\omega=K^{-\top}K^{-1}$。因此包括在$K$中的摄像机内参数信息可以用来约束或确定$\omega$的元素。在已知$K$的扭曲因子为零（$s=0$）时有$\omega_{12}=\omega_{21}=0$，若像素还是正方形（零扭曲参数且$\alpha_x=\alpha_y$），则$\omega_{11}=\omega_{22}$
- **同一摄像机在多幅图像中的约束**：绝对二次曲线的一个性质是它在图像上的投影只依赖于摄像机的标定矩阵，而不依赖于摄像机的位置和方向。当两个摄像机具有相同的标定矩阵时(通常意味着同一摄像机在不同位置拍摄的两幅图像)则有$\omega=\omega^\prime$，即绝对二次曲线在两幅图像上的像是相同的，给定足够多的图像，可以利用这个性质从仿射重构得到度量重构

### 利用$\omega$直接度量重构

- 最明显的方法是利用IAC（绝对二次曲线）来计算每个摄像机的标定，然后再进行己知标定下的重构
- 另一个更概念性的方法是运用IAC的信息直接确定无穷远平面和绝对二次曲线

## 直接重构——利用地面知识

- 在射影重构下，控制点$\{\mathbf{X}_i\}$的 3D 位置可以有它们图像对应点$\mathbf{x}_i \leftrightarrow \mathbf{x}_i^\prime$来计算。因为该射影重构通过一个单应联系于真正的重构：$\mathbf{X}_{Ei}=H\mathbf{X}_i, i=1,...,n$
- 每组点对应提供关于 H 元素的三个独立线性方程。因为 H 有 15 个自由度，故若提供$n \ge 5$组（且没有四个控制点是共面的）点对应，便可以得到一个线性解
- 另一种方法可以不计算$\mathbf{X}_i$而通过把已知的地面控制点直接与图像的度量相联系的途径来计算 H。因此类似于计算摄像机矩阵的$DLT$算法：$\mathbf{x}_i = PH^{-1} \mathbf{X}_{Ei}$


